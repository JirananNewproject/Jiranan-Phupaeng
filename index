<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Expense Ultra ProMax</title>

<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>
body{
    font-family:'Kanit',sans-serif;
    background:#eef5ff;
    margin:0;
    padding:20px;
}
.container{
    max-width:1200px;
    margin:auto;
    background:white;
    padding:20px;
    border-radius:12px;
    box-shadow:0 5px 15px rgba(0,0,0,0.08);
}
h2{ text-align:center; color:#0d6efd; }

.form-grid{
    display:grid;
    grid-template-columns: repeat(auto-fit,minmax(150px,1fr));
    gap:10px;
    margin-bottom:15px;
}

input,select{
    padding:8px;
    border-radius:6px;
    border:1px solid #ccc;
}

button{
    background:#0d6efd;
    color:white;
    border:none;
    border-radius:6px;
    padding:8px;
    cursor:pointer;
}
button:hover{ background:#084298; }

table{
    width:100%;
    border-collapse:collapse;
    margin-top:10px;
}
th{ background:#e7f1ff; }
th,td{
    border:1px solid #ddd;
    padding:8px;
    text-align:center;
}

.card-grid{
    display:grid;
    grid-template-columns: repeat(auto-fit,minmax(200px,1fr));
    gap:10px;
    margin-top:20px;
}

.card{
    background:#e7f1ff;
    padding:15px;
    border-radius:10px;
}

.lock-screen{
    position:fixed;
    inset:0;
    background:#ffffff;
    display:flex;
    justify-content:center;
    align-items:center;
    flex-direction:column;
}
</style>
</head>
<body>

<div id="lock" class="lock-screen">
<h2>üîê ‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</h2>
<input type="password" id="passInput" placeholder="‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢">
<button onclick="checkPassword()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
</div>

<div class="container" id="app" style="display:none">

<h2>üí∞ Expense ULTRA PROMAX</h2>

<div class="form-grid">
<input type="date" id="date">
<input type="text" id="item" placeholder="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£">
<select id="category">
<option>‡∏≠‡∏≤‡∏´‡∏≤‡∏£</option>
<option>‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</option>
<option>‡∏Ç‡∏≠‡∏á‡πÉ‡∏ä‡πâ</option>
<option>‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
</select>
<input type="number" id="amount" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô">
<select id="currency">
<option value="ETB">Birr</option>
<option value="THB">‡∏ö‡∏≤‡∏ó</option>
</select>
<input type="number" id="rate" value="0.65" step="0.01">
<button onclick="addExpense()">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
<button onclick="exportExcel()">Excel</button>
<button onclick="exportJSON()">Backup</button>
<input type="file" onchange="importJSON(event)">
</div>

<select id="filterMonth" onchange="render()"></select>

<table>
<thead>
<tr>
<th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
<th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
<th>‡∏´‡∏°‡∏ß‡∏î</th>
<th>Birr</th>
<th>‡∏ö‡∏≤‡∏ó</th>
<th>‡∏•‡∏ö</th>
</tr>
</thead>
<tbody id="expenseTable"></tbody>
</table>

<div class="card-grid">
<div class="card" id="daily"></div>
<div class="card" id="weekly"></div>
<div class="card" id="monthly"></div>
</div>

<canvas id="monthChart"></canvas>
<canvas id="catChart"></canvas>

</div>

<script>

let expenses = JSON.parse(localStorage.getItem("ultraExpenses")) || [];
let password = localStorage.getItem("expensePass");

function checkPassword(){
    const input=document.getElementById("passInput").value;
    if(!password){
        localStorage.setItem("expensePass",input);
        password=input;
    }
    if(input===password){
        document.getElementById("lock").style.display="none";
        document.getElementById("app").style.display="block";
        initMonthFilter();
        render();
    }else{
        alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏¥‡∏î");
    }
}

function save(){
    localStorage.setItem("ultraExpenses",JSON.stringify(expenses));
}

function addExpense(){
    const date=dateInput.value;
    const item=itemInput.value;
    const category=categoryInput.value;
    const amount=parseFloat(amountInput.value);
    const currency=currencyInput.value;
    const rate=parseFloat(rateInput.value);

    if(!date||!item||!amount) return alert("‡∏Å‡∏£‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");

    let birr=0,baht=0;
    if(currency==="ETB"){ birr=amount; baht=amount*rate; }
    else{ baht=amount; birr=amount/rate; }

    expenses.push({date,item,category,birr,baht});
    save();
    render();
}

function deleteExpense(i){
    expenses.splice(i,1);
    save();
    render();
}

function render(){
    const filter=filterMonth.value;
    const tbody=expenseTable;
    tbody.innerHTML="";

    const filtered=filter?expenses.filter(e=>e.date.startsWith(filter)):expenses;

    filtered.forEach((e,i)=>{
        tbody.innerHTML+=`
        <tr>
        <td>${e.date}</td>
        <td>${e.item}</td>
        <td>${e.category}</td>
        <td>${e.birr.toFixed(2)}</td>
        <td>${e.baht.toFixed(2)}</td>
        <td><button onclick="deleteExpense(${i})">‡∏•‡∏ö</button></td>
        </tr>`;
    });

    summary(filtered);
    drawCharts();
}

function summary(list){
    let totalBirr=0,totalBaht=0;
    list.forEach(e=>{ totalBirr+=e.birr; totalBaht+=e.baht; });

    monthly.innerHTML=`<b>‡∏£‡∏ß‡∏°</b><br>${totalBirr.toFixed(2)} Birr<br>${totalBaht.toFixed(2)} ‡∏ö‡∏≤‡∏ó`;
    daily.innerHTML="";
    weekly.innerHTML="";
}

function initMonthFilter(){
    const months=[...new Set(expenses.map(e=>e.date.substring(0,7)))];
    filterMonth.innerHTML="<option value=''>‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>";
    months.forEach(m=>{
        filterMonth.innerHTML+=`<option value="${m}">${m}</option>`;
    });
}

let monthChart,catChart;

function drawCharts(){
    const monthMap={},catMap={};

    expenses.forEach(e=>{
        const m=e.date.substring(0,7);
        if(!monthMap[m]) monthMap[m]=0;
        monthMap[m]+=e.baht;

        if(!catMap[e.category]) catMap[e.category]=0;
        catMap[e.category]+=e.baht;
    });

    if(monthChart) monthChart.destroy();
    if(catChart) catChart.destroy();

    monthChart=new Chart(monthChartCanvas,{
        type:"bar",
        data:{
            labels:Object.keys(monthMap),
            datasets:[{label:"‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏ö‡∏≤‡∏ó)",data:Object.values(monthMap),backgroundColor:"#0d6efd"}]
        }
    });

    catChart=new Chart(catChartCanvas,{
        type:"pie",
        data:{
            labels:Object.keys(catMap),
            datasets:[{data:Object.values(catMap)}]
        }
    });
}

function exportExcel(){
    const ws=XLSX.utils.json_to_sheet(expenses);
    const wb=XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb,ws,"Expenses");
    XLSX.writeFile(wb,"UltraExpenses.xlsx");
}

function exportJSON(){
    const blob=new Blob([JSON.stringify(expenses)],{type:"application/json"});
    const url=URL.createObjectURL(blob);
    const a=document.createElement("a");
    a.href=url;
    a.download="backup.json";
    a.click();
}

function importJSON(event){
    const file=event.target.files[0];
    const reader=new FileReader();
    reader.onload=e=>{
        expenses=JSON.parse(e.target.result);
        save();
        render();
    };
    reader.readAsText(file);
}

</script>

</body>
</html>
